name: btc_deep_20260218
objective: |
  Deep exploration of BTC signal strategies at underexplored timeframes.
  Focus on robustness validation and filling gaps in the parameter space.

  Benchmark: BTC Don4h(30,25) flat Sharpe 1.702@30bps, DSR 0.991.
  Validated best: BTC Don8h(40,10) iv(vw30,tv0.2) Sharpe 2.045@30bps.

  Use experiment_runner.run() for all evaluations. Do NOT re-implement signals.

  ## Overnight priorities (2026-02-18)

  **Priority 0 — 2020-2023 investigation**: BTC Don8h best is 1.087 on 2020+
  vs ETH 1.762. Why? Run top 5 BTC configs on 2020-2023 specifically.
  Is BTC structurally weaker post-2020 or parameter sensitivity? Report analysis.

  **Priority 0 — Don8h(40,10) neighborhood**: entry[35,40,45,50], exit[8,10,12,15]
  with iv(vw30,tv0.2). Expand the robustness finding — is sweet spot entry 35-50
  exit 8-15 or narrower?

  **Priority 1 — BTC Don4h inv_vol**: ETH found Don4h promising. Test BTC 4h
  with entry[80,100,120,140,160], exit[30,40,50], inv_vol. Competitive with 8h?

  **Priority 2 — 100bps cost test**: Run top 3 configs at 100bps. If they survive
  above Sharpe 1.0 at extreme costs, strong evidence the edge is real.

  Output: ranked table by DSR with Sharpe@30, Sharpe@50, MaxDD, sub-periods,
  n_trades(2020+), and neighbor stability analysis for top configs.

constraints:
  assets: [btc]
  timeframes: [2h, 4h, 8h]
  gpu_required: false
  transaction_costs_bps: 30
  n_trials_start: 627
  n_trials_cumulative: true

strategy_space:
  - family: btc_donchian_8h_neighborhood
    description: >
      Don8h(40,10) neighborhood: entry[35,40,45,50], exit[8,10,12,15]
      with iv(vw30,tv0.2). Map the robustness region.
    priority: 0
    parameter_ranges:
      entry_period: [35, 40, 45, 50]
      exit_period: [8, 10, 12, 15]
      sizing: [inverse_vol]
      vol_window: [30]
      target_vol: [0.2]

  - family: btc_2020_investigation
    description: >
      Run top 5 BTC configs on 2020-2023 sub-period specifically.
      Report structural analysis of why BTC underperforms ETH post-2020.
    priority: 0
    parameter_ranges:
      entry_period: [35, 40, 45, 50, 80]
      exit_period: [10, 15, 40]
      sizing: [flat, inverse_vol]

  - family: btc_donchian_4h_invvol
    description: >
      ETH found Don4h promising. Test BTC 4h with inv_vol.
      Entry 80-160, exit 30-50.
    priority: 1
    parameter_ranges:
      entry_period: [80, 100, 120, 140, 160]
      exit_period: [30, 40, 50]
      sizing: [inverse_vol]
      vol_window: [20, 30, 45]
      target_vol: [0.15, 0.2, 0.3]

  - family: btc_cost_degradation
    description: >
      Run top 3 configs at 100bps. If Sharpe > 1.0 at extreme costs,
      strong evidence the edge is real.
    priority: 2
    parameter_ranges:
      transaction_costs_bps: [100]

  - family: btc_donchian_2h_robustness
    description: >
      BTC_Don2h(80,40) scored Sharpe 1.819. Sweep neighbors to validate:
      entry 60-100, exit 30-50. Test flat + inverse_vol (with corrected ppy).
      Report whether the (80,40) region is robust or isolated.
    priority: 3
    parameter_ranges:
      entry_period: [60, 70, 80, 90, 100]
      exit_period: [30, 35, 40, 45, 50]
      sizing: [flat, inverse_vol]
      vol_window: [20, 30, 40]
      target_vol: [0.2, 0.3, 0.4]

  - family: btc_bollinger_2h
    description: >
      Completely untested: Bollinger breakout on BTC 2h. Different signal
      from Donchian — potential diversifier within BTC timeframes.
    priority: 4
    parameter_ranges:
      period: [15, 20, 30, 40, 60]
      num_std: [1.5, 2.0, 2.5]
      hold_periods: [10, 20, 40]
      sizing: [flat, inverse_vol]

  - family: btc_donchian_8h_deep
    description: >
      BTC Donchian at 8h — lightly explored. Partial diversifier
      vs 2h/4h due to different trade frequency.
    priority: 3
    parameter_ranges:
      entry_period: [20, 30, 40, 50, 60]
      exit_period: [10, 15, 20, 25, 30]
      sizing: [flat, inverse_vol]

stopping_criteria:
  stop_on_success: false
  success:
    min_sharpe: 1.0
    min_dsr: 0.95
  budget:
    max_sessions: 12
    max_hours: 8
    max_cost_usd: 35
    digest_every: 3
  stall:
    sessions_without_improvement: 8
    improvement_threshold: 0.01
    diversity_threshold: 0.99

session_limits:
  max_session_minutes: 360
  max_cost_per_session: 8.0
  min_session_minutes: 5
  max_consecutive_crashes: 3

wandb_tags: [btc_deep, 20260218, agent_b]

gates:
  - trigger: stall_detected
    action: pause_and_alert

exclusions:
  - "DO NOT explore mean-reversion signals on BTC. Confirmed null result (DSR < 0.05 across all configs)."
  - "Use experiment_runner.sweep() for parameter sweeps, run_custom_signal() for novel signals, portfolio_combine() for multi-strategy portfolios. Do not re-implement data loading, cost models, metrics, sub-period analysis, or W&B logging in experiment scripts."
  - "Do NOT proceed to OOS evaluation. Stay in-sample."
  - "Do not build paper trading infrastructure"
  - "Always use sparky.data.loader.load() — never pd.read_parquet()"
  - "Always use compute_all_metrics and report DSR"
  - "Report DSR at three levels: per-family n_trials, per-asset n_trials, and global n_trials. Use per-family DSR for candidate ranking."
  - "Always include transaction costs — report Sharpe at BOTH 30 bps and 50 bps"
  - "n_trials starts at 627. Increment for every config tested."
  - "Sub-period validation mandatory: full IS, 2017-2023, 2020-2023"
  - "Minimum 30 trades on the 2020-2023 sub-period"
  - "Compare every result against BTC Don4h(30,25) flat benchmark (Sharpe 1.702)"
  - "periods_per_year: 4380 (2h), 2190 (4h), 1095 (8h). Never use 252 or 365 for intraday."
